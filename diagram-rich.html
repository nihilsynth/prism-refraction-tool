<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prism Solver (Full Diagram)</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f6f7fb;margin:0;padding:10px}
    .card{max-width:860px;margin:0 auto;background:#fff;padding:12px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
    h2{margin:0 0 6px;font-size:1.2rem}
    .muted{font-size:12px;color:#666;margin-bottom:10px}
    svg{width:100%;height:auto;border:1px solid #ddd;border-radius:8px;background:#fafafa}
    .eq,.worked{background:#f9fbff;border:1px solid #dbe6ff;border-radius:8px;padding:10px;margin-top:10px;font-size:14px;line-height:1.45}
    .field{margin:10px 0}
    label{display:block;font-weight:700;margin-bottom:5px}
    input{width:100%;padding:10px;border:1px solid #bbb;border-radius:8px;font-size:16px;min-width:0}
    input.calc{background:#eef8ee;font-weight:700}
    .btn{width:100%;padding:11px;border:0;border-radius:8px;background:#2d6df6;color:#fff;font-weight:700;font-size:16px;margin-top:8px}
    .btn.secondary{background:#777}
    .ok,.err{padding:10px;border-radius:8px;margin-top:10px;display:none}
    .ok{background:#e8f7e8;border-left:4px solid #3aa14a}
    .err{background:#ffeaea;border-left:4px solid #d33}
    @media(min-width:720px){
      .inputs{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    }
  </style>
</head>
<body>
<div class="card">
  <h2>Prism Refraction Solver (Full sketch-style diagram)</h2>
  <div class="muted">Now includes extra normals and angle markers like your drawing: i₁, r₁, d₁, r₂, d₂, i₂, A, n/n′.</div>

  <svg viewBox="0 0 760 560" aria-label="Prism full diagram">
    <defs>
      <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#333"/></marker>
    </defs>

    <!-- prism -->
    <polygon points="380,70 610,470 150,470" fill="#e5f1ff" stroke="#2e5eaa" stroke-width="3"/>

    <!-- ray path -->
    <line x1="20" y1="300" x2="250" y2="320" stroke="#2b66ff" stroke-width="4" marker-end="url(#arr)"/>
    <line x1="250" y1="320" x2="470" y2="320" stroke="#2ca24a" stroke-width="4" marker-end="url(#arr)"/>
    <line x1="470" y1="320" x2="740" y2="365" stroke="#d83b3b" stroke-width="4" marker-end="url(#arr)"/>

    <!-- normals at faces (extended like sketch) -->
    <line x1="250" y1="220" x2="250" y2="430" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>
    <line x1="470" y1="220" x2="470" y2="430" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>

    <!-- diagonal helper normal-ish lines (to mimic sketch complexity) -->
    <line x1="210" y1="345" x2="365" y2="520" stroke="#7a7a7a" stroke-width="2" stroke-dasharray="10 10"/>
    <line x1="510" y1="345" x2="355" y2="520" stroke="#7a7a7a" stroke-width="2" stroke-dasharray="10 10"/>

    <!-- apex angle A arc -->
    <path d="M338,150 A70,70 0 0 0 422,150" fill="none" stroke="#222" stroke-width="4"/>
    <text x="374" y="135" text-anchor="middle" font-size="42" font-weight="700" fill="#222">A</text>

    <!-- left side angle arcs and labels -->
    <path d="M210,300 A45,45 0 0 1 250,276" fill="none" stroke="#2b66ff" stroke-width="4"/>
    <text x="205" y="288" fill="#2b66ff" font-size="34" font-weight="700">i₁</text>

    <path d="M250,320 A40,40 0 0 1 286,350" fill="none" stroke="#2ca24a" stroke-width="4"/>
    <text x="278" y="358" fill="#2ca24a" font-size="30" font-weight="700">r₁</text>

    <path d="M250,320 A58,58 0 0 1 305,292" fill="none" stroke="#4f62ff" stroke-width="3" stroke-dasharray="6 6"/>
    <text x="312" y="300" fill="#4f62ff" font-size="30" font-weight="700">d₁</text>

    <!-- right side angle arcs and labels -->
    <path d="M470,320 A40,40 0 0 1 434,350" fill="none" stroke="#2ca24a" stroke-width="4"/>
    <text x="424" y="358" fill="#2ca24a" font-size="30" font-weight="700">r₂</text>

    <path d="M470,320 A58,58 0 0 0 525,292" fill="none" stroke="#d83b3b" stroke-width="3" stroke-dasharray="6 6"/>
    <text x="526" y="300" fill="#d83b3b" font-size="30" font-weight="700">d₂</text>

    <path d="M470,320 A54,54 0 0 1 516,360" fill="none" stroke="#d83b3b" stroke-width="4"/>
    <text x="520" y="365" fill="#d83b3b" font-size="34" font-weight="700">i₂</text>

    <!-- corner labels n and n' -->
    <text x="168" y="452" fill="#2e5eaa" font-size="34" font-weight="700">n</text>
    <text x="196" y="458" fill="#2e5eaa" font-size="28" font-weight="700">n′</text>
    <text x="587" y="452" fill="#2e5eaa" font-size="34" font-weight="700">n</text>
    <text x="617" y="458" fill="#2e5eaa" font-size="28" font-weight="700">n′</text>
  </svg>

  <div class="eq">
    <b>Equations used:</b><br>
    1) sin(i₁) = n·sin(r₁)<br>
    2) A = r₁ + r₂<br>
    3) n·sin(r₂) = sin(i₂)<br>
    4) δ = i₁ + i₂ − A
  </div>

  <div class="inputs">
    <div class="field"><label>i₁ (incident angle, °)</label><input id="i1" type="number" step="0.01" placeholder="40"></div>
    <div class="field"><label>A (apical angle, °)</label><input id="A" type="number" step="0.01" placeholder="50"></div>
    <div class="field"><label>n (refractive index)</label><input id="n" type="number" step="0.001" placeholder="1.58"></div>
    <div class="field"><label>r₁ (°)</label><input id="r1" readonly></div>
    <div class="field"><label>r₂ (°)</label><input id="r2" readonly></div>
    <div class="field"><label>i₂ (°)</label><input id="i2" readonly></div>
    <div class="field"><label>δ total deviation (°)</label><input id="D" readonly></div>
  </div>

  <button class="btn" onclick="solve()">Update</button>
  <button class="btn secondary" onclick="resetAll()">Reset</button>

  <div id="ok" class="ok"></div>
  <div id="err" class="err"></div>
  <div id="worked" class="worked" style="display:none"></div>
</div>

<script>
function rad(d){return d*Math.PI/180} function deg(r){return r*180/Math.PI}
function by(id){return document.getElementById(id)}
function setv(id,v){const e=by(id); e.value=Number(v).toFixed(2); e.classList.add('calc')}
function msg(type,txt){by('ok').style.display='none'; by('err').style.display='none'; const el=by(type); el.innerHTML=txt; el.style.display='block'}
function clearOut(){['r1','r2','i2','D'].forEach(k=>{by(k).value='';by(k).classList.remove('calc')}); by('worked').style.display='none'}
function solve(){
  clearOut();
  const i1=parseFloat(by('i1').value), A=parseFloat(by('A').value), n=parseFloat(by('n').value);
  if([i1,A,n].some(v=>Number.isNaN(v))){msg('err','Enter i₁, A, n first.');return}
  if(n<=1){msg('err','n must be > 1');return}
  const s1=Math.sin(rad(i1))/n; if(Math.abs(s1)>1){msg('err','No real solution at first face.');return}
  const r1=deg(Math.asin(s1)); const r2=A-r1; if(r2<=0){msg('err','Invalid geometry: r₂ <= 0');return}
  const s2=n*Math.sin(rad(r2)); if(Math.abs(s2)>1){setv('r1',r1); setv('r2',r2); msg('err','Total internal reflection at second face.'); return}
  const i2=deg(Math.asin(s2)); const D=i1+i2-A;
  setv('r1',r1); setv('r2',r2); setv('i2',i2); setv('D',D);
  msg('ok',`✓ Solved: r₁=${r1.toFixed(2)}°, r₂=${r2.toFixed(2)}°, i₂=${i2.toFixed(2)}°, δ=${D.toFixed(2)}°`);
  by('worked').innerHTML=`<b>Worked:</b><br>sin(r₁)=sin(${i1.toFixed(2)})/${n.toFixed(3)}=${s1.toFixed(4)} ⇒ r₁=${r1.toFixed(2)}°<br>r₂=A−r₁=${A.toFixed(2)}−${r1.toFixed(2)}=${r2.toFixed(2)}°<br>sin(i₂)=${n.toFixed(3)}·sin(${r2.toFixed(2)})=${s2.toFixed(4)} ⇒ i₂=${i2.toFixed(2)}°<br>δ=i₁+i₂−A=${i1.toFixed(2)}+${i2.toFixed(2)}−${A.toFixed(2)}=<b>${D.toFixed(2)}°</b>`;
  by('worked').style.display='block';
}
function resetAll(){['i1','A','n','r1','r2','i2','D'].forEach(k=>{by(k).value='';by(k).classList.remove('calc')}); by('ok').style.display='none'; by('err').style.display='none'; by('worked').style.display='none';}
</script>
</body>
</html>