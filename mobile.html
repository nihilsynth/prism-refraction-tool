<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Prism Solver (Mobile)</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f6f7fb;margin:0;padding:10px}
    .card{max-width:760px;margin:0 auto;background:#fff;padding:12px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.1)}
    h2{margin:0 0 6px;font-size:1.2rem}
    .muted{font-size:12px;color:#666;margin-bottom:10px}
    svg{width:100%;height:auto;border:1px solid #ddd;border-radius:8px;background:#fafafa}
    .eq{background:#f9fbff;border:1px solid #dbe6ff;border-radius:8px;padding:10px;margin-top:10px;font-size:14px;line-height:1.45}
    .field{margin:10px 0}
    label{display:block;font-weight:700;margin-bottom:5px}
    input{width:100%;padding:10px;border:1px solid #bbb;border-radius:8px;font-size:16px}
    input.calc{background:#eef8ee;font-weight:700}
    .btn{width:100%;padding:11px;border:0;border-radius:8px;background:#2d6df6;color:#fff;font-weight:700;font-size:16px;margin-top:8px}
    .btn.secondary{background:#777}
    .ok,.err{padding:10px;border-radius:8px;margin-top:10px;display:none}
    .ok{background:#e8f7e8;border-left:4px solid #3aa14a}
    .err{background:#ffeaea;border-left:4px solid #d33}
  </style>
</head>
<body>
<div class="card">
  <h2>Prism Refraction Solver (Exam Labels)</h2>
  <div class="muted">Labels match your diagram: i₁, r₁, r₂, i₂, A, n/n′</div>

  <svg viewBox="0 0 700 480" aria-label="Prism diagram">
    <defs><marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#333"/></marker></defs>
    <polygon points="350,70 560,390 140,390" fill="#dff0ff" stroke="#2e5eaa" stroke-width="3"/>
    <line x1="40" y1="220" x2="250" y2="260" stroke="#2b66ff" stroke-width="4" marker-end="url(#arr)"/>
    <line x1="250" y1="260" x2="450" y2="260" stroke="#2ca24a" stroke-width="4" marker-end="url(#arr)"/>
    <line x1="450" y1="260" x2="650" y2="300" stroke="#e23b3b" stroke-width="4" marker-end="url(#arr)"/>
    <line x1="250" y1="170" x2="250" y2="350" stroke="#777" stroke-width="2" stroke-dasharray="8 8"/>
    <line x1="450" y1="170" x2="450" y2="350" stroke="#777" stroke-width="2" stroke-dasharray="8 8"/>
    <text x="205" y="238" fill="#2b66ff" font-size="28" font-weight="700">i₁</text>
    <text x="285" y="246" fill="#2ca24a" font-size="28" font-weight="700">r₁</text>
    <text x="407" y="246" fill="#2ca24a" font-size="28" font-weight="700">r₂</text>
    <text x="480" y="286" fill="#e23b3b" font-size="28" font-weight="700">i₂</text>
    <text x="338" y="130" fill="#222" font-size="38" font-weight="700">A</text>
    <text x="175" y="378" fill="#2e5eaa" font-size="24" font-weight="700">n</text>
    <text x="515" y="378" fill="#2e5eaa" font-size="24" font-weight="700">n′</text>
  </svg>

  <div class="eq">
    1) sin(i₁) = n·sin(r₁)<br>
    2) A = r₁ + r₂<br>
    3) n·sin(r₂) = sin(i₂)<br>
    4) δ = i₁ + i₂ − A
  </div>

  <div class="field"><label>i₁ (incident angle, °)</label><input id="i1" type="number" step="0.01" placeholder="40"></div>
  <div class="field"><label>A (apical angle, °)</label><input id="A" type="number" step="0.01" placeholder="50"></div>
  <div class="field"><label>n (refractive index)</label><input id="n" type="number" step="0.001" placeholder="1.58"></div>

  <div class="field"><label>r₁ (°)</label><input id="r1" readonly></div>
  <div class="field"><label>r₂ (°)</label><input id="r2" readonly></div>
  <div class="field"><label>i₂ (°)</label><input id="i2" readonly></div>
  <div class="field"><label>δ total deviation (°)</label><input id="D" readonly></div>

  <button class="btn" onclick="solve()">Update</button>
  <button class="btn secondary" onclick="resetAll()">Reset</button>

  <div id="ok" class="ok"></div>
  <div id="err" class="err"></div>
  <div id="worked" class="eq" style="display:none"></div>
</div>

<script>
function rad(d){return d*Math.PI/180} function deg(r){return r*180/Math.PI}
function by(id){return document.getElementById(id)}
function setv(id,v){const e=by(id); e.value=Number(v).toFixed(2); e.classList.add('calc')}
function msg(type,txt){by('ok').style.display='none'; by('err').style.display='none'; const el=by(type); el.innerHTML=txt; el.style.display='block'}
function clearOut(){['r1','r2','i2','D'].forEach(k=>{by(k).value='';by(k).classList.remove('calc')}); by('worked').style.display='none'}
function solve(){
  clearOut();
  const i1=parseFloat(by('i1').value), A=parseFloat(by('A').value), n=parseFloat(by('n').value);
  if([i1,A,n].some(v=>Number.isNaN(v))){msg('err','Enter i₁, A, n first.');return}
  if(n<=1){msg('err','n must be > 1');return}
  const s1=Math.sin(rad(i1))/n; if(Math.abs(s1)>1){msg('err','No real solution at first face.');return}
  const r1=deg(Math.asin(s1)); const r2=A-r1; if(r2<=0){msg('err','Invalid geometry: r₂ <= 0');return}
  const s2=n*Math.sin(rad(r2)); if(Math.abs(s2)>1){setv('r1',r1); setv('r2',r2); msg('err','Total internal reflection at second face.'); return}
  const i2=deg(Math.asin(s2)); const D=i1+i2-A;
  setv('r1',r1); setv('r2',r2); setv('i2',i2); setv('D',D);
  msg('ok',`✓ Solved: r₁=${r1.toFixed(2)}°, r₂=${r2.toFixed(2)}°, i₂=${i2.toFixed(2)}°, δ=${D.toFixed(2)}°`);
  by('worked').innerHTML=`<b>Worked:</b><br>sin(r₁)=sin(${i1.toFixed(2)})/${n.toFixed(3)}=${s1.toFixed(4)} ⇒ r₁=${r1.toFixed(2)}°<br>r₂=A−r₁=${A.toFixed(2)}−${r1.toFixed(2)}=${r2.toFixed(2)}°<br>sin(i₂)=${n.toFixed(3)}·sin(${r2.toFixed(2)})=${s2.toFixed(4)} ⇒ i₂=${i2.toFixed(2)}°<br>δ=i₁+i₂−A=${i1.toFixed(2)}+${i2.toFixed(2)}−${A.toFixed(2)}=<b>${D.toFixed(2)}°</b>`;
  by('worked').style.display='block';
}
function resetAll(){['i1','A','n','r1','r2','i2','D'].forEach(k=>{by(k).value='';by(k).classList.remove('calc')}); by('ok').style.display='none'; by('err').style.display='none'; by('worked').style.display='none';}
</script>
</body>
</html>