<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Prism Refraction (Matched Diagram)</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#fff;padding:10px}
    .wrap{max-width:860px;margin:0 auto}
    h2{margin:0 0 6px;font-size:1.15rem}
    .muted{font-size:12px;color:#555;margin:0 0 10px}
    svg{width:100%;height:auto;border:1px solid #ddd;background:#fff;border-radius:6px}
    .panel{margin-top:10px;padding:10px;border:1px solid #ddd;border-radius:6px}
    .row{display:grid;grid-template-columns:1fr 125px;gap:10px;align-items:center;margin:8px 0}
    input{width:100%;padding:8px;border:1px solid #aaa;border-radius:6px;font-size:16px;min-width:0}
    input.calc{background:#eef8ee;font-weight:700}
    .btn{width:100%;padding:11px;border:0;border-radius:8px;background:#1457d5;color:#fff;font-weight:700;font-size:16px;margin-top:8px}
    .btn.secondary{background:#777}
    .ok,.err{padding:9px;border-radius:6px;margin-top:10px;display:none}
    .ok{background:#e8f7e8;border-left:4px solid #2f9b3f}
    .err{background:#ffeaea;border-left:4px solid #cf2f2f}
    .eq{font-size:14px;line-height:1.45}
    @media(max-width:640px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Prism Refraction Solver (matched to your sketch)</h2>
  <p class="muted">Same visual style/labels: i₁, r₁, d₁, d₂, i₂, A, n, n′</p>

  <svg viewBox="0 0 760 560" aria-label="Matched prism diagram">
    <defs>
      <marker id="arrBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#2d57d8"/></marker>
      <marker id="arrGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#2f9b63"/></marker>
      <marker id="arrRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#d34a65"/></marker>
    </defs>

    <!-- prism -->
    <polygon points="380,70 610,470 150,470" fill="none" stroke="#333" stroke-width="3"/>

    <!-- rays (coloured like your photo) -->
    <line x1="20" y1="300" x2="255" y2="320" stroke="#2d57d8" stroke-width="4" marker-end="url(#arrBlue)"/>
    <line x1="255" y1="320" x2="470" y2="320" stroke="#2f9b63" stroke-width="4" marker-end="url(#arrGreen)"/>
    <line x1="470" y1="320" x2="740" y2="370" stroke="#d34a65" stroke-width="4" marker-end="url(#arrRed)"/>

    <!-- dashed outer continuation lines -->
    <line x1="80" y1="245" x2="205" y2="300" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>
    <line x1="515" y1="300" x2="640" y2="245" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>

    <!-- dashed central helper lines -->
    <line x1="255" y1="250" x2="520" y2="250" stroke="#5563d4" stroke-width="2" stroke-dasharray="10 10" opacity="0.8"/>
    <line x1="255" y1="320" x2="380" y2="500" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>
    <line x1="470" y1="320" x2="380" y2="500" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>

    <!-- local normals at both interfaces -->
    <line x1="255" y1="235" x2="255" y2="405" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>
    <line x1="470" y1="235" x2="470" y2="405" stroke="#666" stroke-width="2" stroke-dasharray="10 10"/>

    <!-- apex angle -->
    <path d="M338,150 A70,70 0 0 0 422,150" fill="none" stroke="#333" stroke-width="4"/>
    <text x="380" y="136" text-anchor="middle" font-size="42" font-weight="700" fill="#333">A</text>

    <!-- angle arcs/labels -->
    <path d="M215,297 A48,48 0 0 1 255,270" fill="none" stroke="#2d57d8" stroke-width="4"/>
    <text x="205" y="288" fill="#2d57d8" font-size="36" font-weight="700">i₁</text>

    <path d="M255,320 A42,42 0 0 1 291,352" fill="none" stroke="#2f9b63" stroke-width="4"/>
    <text x="285" y="360" fill="#2f9b63" font-size="32" font-weight="700">r₁</text>

    <text x="320" y="305" fill="#4f62ff" font-size="34" font-weight="700">d₁</text>

    <path d="M470,320 A42,42 0 0 1 434,352" fill="none" stroke="#2f9b63" stroke-width="4"/>
    <text x="424" y="360" fill="#2f9b63" font-size="32" font-weight="700">r₂</text>

    <text x="516" y="305" fill="#d34a65" font-size="34" font-weight="700">d₂</text>

    <path d="M470,320 A56,56 0 0 1 520,360" fill="none" stroke="#d34a65" stroke-width="4"/>
    <text x="525" y="365" fill="#d34a65" font-size="36" font-weight="700">i₂</text>

    <!-- n / n' corner notes -->
    <text x="168" y="458" fill="#2d57d8" font-size="38" font-weight="700">n</text>
    <text x="198" y="462" fill="#2d57d8" font-size="30" font-weight="700">n′</text>
    <text x="585" y="458" fill="#2d57d8" font-size="38" font-weight="700">n</text>
    <text x="615" y="462" fill="#2d57d8" font-size="30" font-weight="700">n′</text>
  </svg>

  <div class="panel eq">
    <div><b>Equations:</b></div>
    <div>1) sin(i₁) = n·sin(r₁)</div>
    <div>2) A = r₁ + r₂</div>
    <div>3) n·sin(r₂) = sin(i₂)</div>
    <div>4) δ = i₁ + i₂ − A</div>
  </div>

  <div class="panel">
    <div class="row"><label>i₁ (°)</label><input id="i1" type="number" step="0.01" placeholder="40"></div>
    <div class="row"><label>A (°)</label><input id="A" type="number" step="0.01" placeholder="50"></div>
    <div class="row"><label>n</label><input id="n" type="number" step="0.001" placeholder="1.58"></div>
    <hr>
    <div class="row"><label>r₁ (°)</label><input id="r1" readonly></div>
    <div class="row"><label>r₂ (°)</label><input id="r2" readonly></div>
    <div class="row"><label>i₂ (°)</label><input id="i2" readonly></div>
    <div class="row"><label>δ (°)</label><input id="D" readonly></div>
    <button class="btn" onclick="solve()">Update</button>
    <button class="btn secondary" onclick="resetAll()">Reset</button>
    <div id="ok" class="ok"></div>
    <div id="err" class="err"></div>
  </div>
</div>

<script>
function rad(d){return d*Math.PI/180} function deg(r){return r*180/Math.PI}
const by=id=>document.getElementById(id)
function setCalc(id,v){const e=by(id); e.value=Number(v).toFixed(2); e.classList.add('calc')}
function clearCalc(){['r1','r2','i2','D'].forEach(id=>{by(id).value='';by(id).classList.remove('calc')})}
function show(type,text){by('ok').style.display='none';by('err').style.display='none';const el=by(type);el.textContent=text;el.style.display='block'}
function solve(){
  clearCalc();
  const i1=parseFloat(by('i1').value), A=parseFloat(by('A').value), n=parseFloat(by('n').value);
  if([i1,A,n].some(Number.isNaN)){show('err','Enter i₁, A, n first.');return}
  if(n<=1){show('err','n must be > 1');return}
  const s1=Math.sin(rad(i1))/n; if(Math.abs(s1)>1){show('err','No real solution at first face.');return}
  const r1=deg(Math.asin(s1)); const r2=A-r1; if(r2<=0){show('err','Invalid geometry (r₂ <= 0).');return}
  const s2=n*Math.sin(rad(r2)); if(Math.abs(s2)>1){setCalc('r1',r1);setCalc('r2',r2);show('err','Total internal reflection at second face.');return}
  const i2=deg(Math.asin(s2)); const D=i1+i2-A;
  setCalc('r1',r1); setCalc('r2',r2); setCalc('i2',i2); setCalc('D',D);
  show('ok',`Solved: r₁=${r1.toFixed(2)}°, r₂=${r2.toFixed(2)}°, i₂=${i2.toFixed(2)}°, δ=${D.toFixed(2)}°`)
}
function resetAll(){['i1','A','n','r1','r2','i2','D'].forEach(id=>{by(id).value='';by(id).classList.remove('calc')});by('ok').style.display='none';by('err').style.display='none'}
</script>
</body>
</html>